---
layout: post
title: Overriding protected members using Moq and/or RhinoMocks
---

Sometimes I want to override a protected method on an internal class using a mocking framework and make verifications against calls to that method. This problem also occurs when trying to mock an internal interface in the assembly under test.<br /><br />When doing this with Moq or RhinoMocks (both of which use the same proxy generator), I got the following error:<br /><br /><i>"Castle.DynamicProxy.Generators.GeneratorException: Type is not public, so a proxy cannot be generated."</i><br /><br />The solution is to publish the internals of the assembly under test to the appropriate assembly:<br /><br /><pre class="brush: csharp">[assembly: InternalsVisibleTo("DynamicProxyGenAssembly2," +<br />    "PublicKey=00240000048000009400000006020000002400005" +<br />    "25341310004000001000100c547cac37abd99c8db225ef2f6c8" +<br />    "a3602f3b3606cc9891605d02baa56104f4cfc0734aa39b93bf7" +<br />    "852f7d9266654753cc297e7d2edfe0bac1cdcf9f717241550e0" +<br />    "a7b191195b7667bb4f64bcb8e2121380fd1d9d46ad2d92d2d15" +<br />    "605093924cceaf74c4861eff62abf69b9291ed0a340e113be11" +<br />    "e6a7d3113e92484cf7045cc7")]</pre>
