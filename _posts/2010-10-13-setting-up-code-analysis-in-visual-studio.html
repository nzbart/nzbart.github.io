---
layout: post
title: Setting up code analysis in Visual Studio
---

<h4>Code Analysis Rule Files</h4>Copy these files to an appropriate location in the source tree:<br /><h5>For test code:</h5><pre class="brush:xml">&lt;?xml version="1.0" encoding="utf-8"?><br />&lt;RuleSet Name="Test Code" Description="Rules for unit and integration test assemblies." ToolsVersion="11.0"><br />  &lt;IncludeAll Action="Error" /><br />  &lt;Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed"><br />    &lt;Rule Id="CA1004" Action="None" /><br />    &lt;Rule Id="CA1014" Action="None" /><br />    &lt;Rule Id="CA1020" Action="None" /><br />    &lt;Rule Id="CA1024" Action="None" /><br />    &lt;Rule Id="CA1026" Action="None" /><br />    &lt;Rule Id="CA1031" Action="None" /><br />    &lt;Rule Id="CA1062" Action="None" /><br />    &lt;Rule Id="CA1300" Action="None" /><br />    &lt;Rule Id="CA1303" Action="None" /><br />    &lt;Rule Id="CA1502" Action="None" /><br />    &lt;Rule Id="CA1506" Action="None" /><br />    &lt;Rule Id="CA1702" Action="None" /><br />    &lt;Rule Id="CA1707" Action="None" /><br />    &lt;Rule Id="CA1709" Action="None" /><br />    &lt;Rule Id="CA1822" Action="None" /><br />    &lt;Rule Id="CA2204" Action="None" /><br />    &lt;Rule Id="CA2210" Action="None" /><br />  &lt;/Rules><br />&lt;/RuleSet><br /></pre><h5>For production code:</h5><pre class="brush:xml">&lt;?xml version="1.0" encoding="utf-8"?><br />&lt;RuleSet Name="Production Code" Description="Rules for production code." ToolsVersion="11.0"><br />  &lt;IncludeAll Action="Error" /><br />  &lt;Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed"><br />    &lt;Rule Id="CA1004" Action="None" /><br />    &lt;Rule Id="CA1020" Action="None" /><br />    &lt;Rule Id="CA1024" Action="None" /><br />    &lt;Rule Id="CA1026" Action="None" /><br />    &lt;Rule Id="CA1303" Action="None" /><br />    &lt;Rule Id="CA1502" Action="None" /><br />    &lt;Rule Id="CA1506" Action="None" /><br />    &lt;Rule Id="CA1822" Action="None" /><br />    &lt;Rule Id="CA2204" Action="None" /><br />    &lt;Rule Id="CA2210" Action="None" /><br />  &lt;/Rules><br />&lt;/RuleSet><br /></pre><br /><h4>Language</h4>I am not aware of a GUI that allows setting the language for Visual Studio code analysis.<br /><br />To do this manually, add the following line to your <i>.csproj</i> files under the main &lt;PropertyGroup&gt; tag:<br /><br /><pre class="brush:xml">&lt;CodeAnalysisCulture&gt;en-NZ&lt;/CodeAnalysisCulture&gt;</pre><br />This setting is obviously for New Zealand English. Consult <a href="http://msdn.microsoft.com/en-us/library/0h88fahh(VS.85).aspx">this table for the appropriate locale ID</a>.<br /><br /><h4>Custom Dictionary</h4>Set up a custom dictionary file called <i>CustomDictionary.xml</i> and add a link to it in one of your projects. Set the build action (in the properties page) to <i>CodeAnalysisDictionary</i>. To duplicate this into other projects in the same solution, just drag into each of those solutions. I use the following as a default:<br /><pre class="brush:xml">&lt;Dictionary&gt;<br />  &lt;Words&gt;<br />    &lt;Unrecognized&gt;<br />      &lt;Word&gt;&lt;/Word&gt;<br />    &lt;/Unrecognized&gt;<br />    &lt;Recognized&gt;<br />      &lt;Word&gt;Mvc&lt;/Word&gt;<br />      &lt;Word&gt;Serialise&lt;/Word&gt;<br />      &lt;Word&gt;Serialisation&lt;/Word&gt;<br />      &lt;Word&gt;Serialiser&lt;/Word&gt;<br />      &lt;Word&gt;Deserialise&lt;/Word&gt;<br />      &lt;Word&gt;Deserialised&lt;/Word&gt;<br />      &lt;Word&gt;Deserialisation&lt;/Word&gt;<br />      &lt;Word&gt;Nesse&lt;/Word&gt;  &lt;!--From FitNesse--&gt;<br />    &lt;/Recognized&gt;<br />    &lt;Deprecated&gt;<br />      &lt;Term PreferredAlternate=""&gt;&lt;/Term&gt;<br />    &lt;/Deprecated&gt;<br />    &lt;Compound&gt;<br />      &lt;Term CompoundAlternate=""&gt;&lt;/Term&gt;<br />    &lt;/Compound&gt;<br />    &lt;DiscreteExceptions&gt;<br />      &lt;Term&gt;&lt;/Term&gt;<br />    &lt;/DiscreteExceptions&gt;<br />  &lt;/Words&gt;<br />  &lt;Acronyms&gt;<br />  &lt;/Acronyms&gt;<br />&lt;/Dictionary&gt;</pre><br /><h4>Project Configuration</h4>In each project's property pages under the <i>Code Analysis</i> tab, set the rule set to either the test or production set, and enable the code analysis for release builds only. Running code analysis slows down the build and may not be suitable for debug builds.<br /><br /><h4>TFS</h4>In your continuous integration build definition, set code analysis to <i>Always</i>.
