---
layout: post
title: Using the AJAX minifier as an MSBuild task to compress JavaScript
---

<style type='text/css'>body {  font: normal 11px auto "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;  color: #4f6b72;  background: #E6EAE9; }  a {  color: #c75f3e; }  #mytable {  width: 700px;  padding: 0;  margin: 0; }  caption {  padding: 0 0 5px 0;  width: 700px;    font: italic 11px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;  text-align: right; }  th {  font: bold 11px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;  color: #4f6b72;  border-right: 1px solid #C1DAD7;  border-bottom: 1px solid #C1DAD7;  border-top: 1px solid #C1DAD7;  letter-spacing: 2px;  text-transform: uppercase;  text-align: left;  padding: 6px 6px 6px 12px;  background: #CAE8EA url(images/bg_header.jpg) no-repeat; }  th.nobg {  border-top: 0;  border-left: 0;  border-right: 1px solid #C1DAD7;  background: none; }  td {  border-right: 1px solid #C1DAD7;  border-bottom: 1px solid #C1DAD7;  background: #fff;  padding: 6px 6px 6px 12px;  color: #4f6b72; }   td.alt {  background: #F5FAFA;  color: #797268; }  th.spec {  border-left: 1px solid #C1DAD7;  border-top: 0;  background: #fff url(images/bullet1.gif) no-repeat;  font: bold 10px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif; }  th.specalt {  border-left: 1px solid #C1DAD7;  border-top: 0;  background: #f5fafa url(images/bullet2.gif) no-repeat;  font: bold 10px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;  color: #797268; } </style><br /><br />It is possible to us the <a href="http://ajaxmin.codeplex.com/">AJAX Minifier</a> to generate compact Ecmascript (JavaScript) and CSS files.<br /><br />Add the following to your .csproj file within the <code>Project</code> tag. <a href="http://www.asp.net/ajaxlibrary/ajaxminquickstart.ashx">This page gives more detail</a>.<br /><br /><pre class="brush:xml">&lt;Target Name="AfterBuild"><br />  &lt;ItemGroup><br />    &lt;JS Include="**\*.original.js" /><br />    &lt;CSS Include="**\*.original.css" /><br />  &lt;/ItemGroup><br />  &lt;AjaxMin JsSourceFiles="@(JS)" JsSourceExtensionPattern="\.original.js$" JsTargetExtension=".js" <br />            CssSourceFiles="@(CSS)" CssSourceExtensionPattern="\.original.css$" CssTargetExtension=".css"<br />            JsOutputMode="MultipleLines" JsCombineDuplicateLiterals="true"/><br />&lt;/Target><br /></pre><br />The documentation is good except that it does not detail all the options for the MSBuild task. I list them for version 4.0 below, with descriptions copied from various places including the source code and <a href="http://www.asp.net/ajaxlibrary/AjaxMinDLL.ashx">documentation</a>:<br /><br /><table><tr><th>Option</th><th>Effect</th><th>Default</th></tr><tr><td>JsCollapseToLiteral</td><td>Collapse new Array() to [] and new Object() to {}.</td><td>true</td></tr><tr><td>JsCombineDuplicateLiterals</td><td>Combine duplicate literals within function scopes to local variables.</td><td>false</td></tr><tr><td>JsEnsureFinalSemicolon</td><td>Appends a semi-colon to the end of the minified JavaScript.</td><td>true</td></tr><tr><td>JsEvalTreatment</td><td>Normally an eval statement can contain anything, including references to local variables and functions. If it is expected to do so, when the tool encounters an eval statement, that scope and all parent scopes cannot take advantage of local variable and function renaming because things could break when the eval is evaluated and the references are looked up. To reduce the amount of resulting minification but make sure that all possible references in evaluated code will hold true, use the <i>MakeAllSafe</i> value. However, sometimes the developer knows that he’s not referencing local variables in his eval (like when only evaluating JSON objects), and this switch can be set to <i>Ignore</i> to make sure you get the maximum reduction in resulting code size. Or alternatively, if the developer knows the code being evaluated will only access local variables and functions in the current scope and nowhere else, the <i>MakeImmediateSafe</i> value can be specified and all parent scopes will still rename their locals. Very dangerous setting; should only be used when you are certain of all possible behavior of evaluated code. </td><td>Ignore</td></tr><tr><td>JsIndentSize</td><td>For the multi-line output feature, how many spaces to use when indenting a block (see OutputMode).</td><td>4</td></tr><tr><td>JsInlineSafeStrings</td><td>Break up string literals containing &lt;/script&gt; so inline code won't break.</td><td>true</td></tr><tr><td>JsLocalRenaming</td><td>Renaming of locals. There are a couple settings: <i>KeepAll</i> is the default and doesn’t rename variables or functions at all. <i>CrunchAll</i> renames everything it can. In between there is <i>KeepLocalizationVars</i>, which renames everything it can except for variables starting with L_. Those are left as-is so localization efforts can continue on the minified code.</td><td>CrunchAll</td></tr><tr><td>JsMacSafariQuirks</td><td>There are two quirks that Safari on the Mac (not the PC) needed: throw statements always seem to require a terminating semicolon; and if statements that only contains a single function declaration need to surround that function declaration with curly-braces. Basically, if you want your code to always work in Safari, set this to true. If you don’t care about Safari (for instance, in a corporate environment where the browser your users can use is highly restricted), setting this value to false might save a few bytes.</td><td>true</td></tr><tr><td>JsOutputMode</td><td><i>SingleLine</i> minifies everything to a single line. <i>MultipleLines</i> breaks the minified code into multiple lines for easier reading (won’t drive you insane trying to debug a single line). The only difference between the two outputs is whitespace. (see also: IndentSize).</td><td>SingleLine</td></tr><tr><td>JsRemoveFunctionExpressionNames</td><td></td><td>true</td></tr><tr><td>JsRemoveUnneededCode</td><td>Should be set to true for maximum minification. Removes unreferenced local functions (not global functions, though), unreferenced function parameters, quotes around object literal field names that won’t be confused with reserved words, and it does some interesting things with switch statements. For instance, if the default case is empty (just a break), it removes it altogether. If there is no default case, it also removes other empty case statements. It also removes break statements after return statements (unreachable code). </td><td>true</td></tr><tr><td>JsStripDebugStatements</td><td>removes “debugger” statements, any calls into certain namespaces like $Debug, Debug, Web.Debug or Msn.Debug. also strips calls to the WAssert function.</td><td>true</td></tr></table>
