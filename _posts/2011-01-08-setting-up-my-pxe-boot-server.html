---
layout: post
title: Setting up my PXE boot server
---

This is basically a summary for my own records of my PXE boot configuration in case I want to rebuild it. It is quite specific to the distributions I want to access via PXE and to my configuration, so other guides will probably be more useful for readers.<br /><br />Structure:<br /><pre>.<br />|-- debian<br />|   `-- testing<br />|       `-- amd64<br />|           |-- <b>initrd.gz</b><br />|           `-- <b>linux</b><br />|-- <b>menu.c32</b><br />|-- <b>pxelinux.0</b><br />|-- pxelinux.cfg<br />|   |-- <b>default</b><br />|   `-- <b>trinity</b><br />`-- <b>trinity</b><br />    |-- <i>...lots of files..</i>.<br /></pre><br />With files sourced from:<br /><br /><ul><li><a href="http://ftp.uk.debian.org/debian/dists/testing/main/installer-amd64/current/images/netboot/debian-installer/amd64/">Debian distribution from the Debian ftp servers</a>&nbsp;(the folder structure was manually created)</li><li><a href="http://syslinux.zytor.com/wiki/index.php/The_Syslinux_Project">menu.c32 and pxelinux.0 from Syslinux</a></li><li><a href="http://trinityhome.org/">The trinity folder is an extraction of the iso from the Trinity Rescue Kit (TRK)</a></li><li><a href="http://trinityhome.org/"></a>The content of the default and trinity configuration files below</li></ul><p>The folder structure is mounted (or directly in) /var/lib/tftpboot, and it is exported using NFS (for TRK) by the following configuration line in /etc/exports:</p><pre class="brush:plain">/var/lib/tftpboot/trinity *(ro,no_root_squash,no_subtree_check)<br /></pre><br /><p>The folder structure is also exposed using tftpd-hpa (not tftpd) and the DHCP server is using Tomato on my router with the following configuration line in Advanced -> DHCP / DNS -> Dnsmasq custom configuration:</p><pre class="brush:plain">dhcp-boot=pxelinux.0,,192.168.1.13<br /></pre><br />There is some duplication between the two files, but I was happy enough to get them working as I wanted. If I had more time, I would look into <a href="http://syslinux.zytor.com/wiki/index.php/Comboot/menu.c32">MENU INCLUDE</a>.<br /><br />This is the configuration file called <i>default</i>.<br /><pre class="brush:plain">default menu.c32<br />prompt 0<br /><br />menu title Welcome to My Network Boot Menu<br />menu color tabmsg 37;40      #80ffffff #00000000<br />menu color hotsel 30;47      #40000000 #20ffffff<br />menu color sel 30;47      #40000000 #20ffffff<br />menu color scrollbar 30;47      #40000000 #20ffffff<br /><br />MENU WIDTH 75<br />MENU MARGIN 5<br />MENU PASSWORDMARGIN 3<br />MENU ROWS 18<br />MENU TABMSGROW 22<br />MENU CMDLINEROW 22<br />MENU ENDROW 24<br />MENU PASSWORDROW 11<br />MENU TIMEOUTROW 23<br /><br />label 1<br />menu label Debian Install<br />kernel debian/testing/amd64/linux<br />append vga=normal initrd=debian/testing/amd64/initrd.gz  --<br /><br />label 2<br />menu label Debian Expert Install<br />kernel debian/testing/amd64/linux<br />append priority=low vga=normal initrd=debian/testing/amd64/initrd.gz  --<br /><br />label 3<br />menu label Debian Rescue<br />kernel debian/testing/amd64/linux<br />append vga=normal initrd=debian/testing/amd64/initrd.gz rescue/enable=true --<br /><br />label 4<br />menu label Trinity<br />kernel menu.c32<br />append pxelinux.cfg/trinity<br /></pre><br />The following configuration file was generated by trk3/mkpxelinux in the TRK, but I modified it to find kernel.trk and initrd.trk in the trinity sub-folder, then renamed it to <i>trinity</i>:<br /><br />VIM commands:<br /><pre>:%s/kernel\.trk/trinity\/kernel.trk/g<br />:%s/initrd\.trk/trinity\/initrd.trk/g<br />:%s/vesamenu\.c32/menu.c32/g<br /></pre><br />This is the configuration file called <i>trinity</i>.<br /><pre class="brush:plain">default menu.c32<br />prompt 0<br /><br />menu title     build 367<br />menu color tabmsg 37;40      #80ffffff #00000000<br />menu color hotsel 30;47      #40000000 #20ffffff<br />menu color sel 30;47      #40000000 #20ffffff<br />menu color scrollbar 30;47      #40000000 #20ffffff<br /><br />MENU WIDTH 75<br />MENU MARGIN 5<br />MENU PASSWORDMARGIN 3<br />MENU ROWS 18<br />MENU TABMSGROW 22<br />MENU CMDLINEROW 22<br />MENU ENDROW 24<br />MENU PASSWORDROW 11<br />MENU TIMEOUTROW 23<br /><br /><br />label trk3<br />menu label  Run ^Trinity Rescue Kit 3.4 (default mode, with text menu)<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp  splash=verbose pci=conf1 trkmenu<br />timeout 100<br /><br />label 1<br />menu label ^1 : TRK 3.4 in failsafe mode (No menu, VGA, noacpi, noapic)<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose acpi=off noapic pci=conf1 vga=1<br /><br />label 2<br />menu label ^2 : TRK 3.4 running from RAM (best >= 512mb, 256mb min)<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 trkinmem trkmenu<br /><br />label 3<br />menu label ^3 : TRK 3.4 - Run 'mclone' in client mode (!)<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 mclone<br /><br />label 4<br />menu label ^4 : TRK 3.4 in simple VGA mode (debugging of kernel output)<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=1 pci=conf1 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=off trkmenu<br /><br />label 5<br />kernel trinity/kernel.trk<br />menu label ^5 : TRK 3.4 with Belgian keyboard (use menu for other)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 keyb_be trkmenu<br /><br />label 6<br />kernel trinity/kernel.trk<br />menu label ^6 : TRK 3.4 - Virusscan all drives (Clamav, non interactive)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 virusscan<br /><br />label 7<br />kernel trinity/kernel.trk<br />menu label ^7 : TRK 3.4 - Try more pcmcia and usb nics (when not detected)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 pcmcia trkmenu<br /><br />label 8<br />kernel trinity/kernel.trk<br />menu label ^8 : TRK 3.4 - Try more SCSI drivers (when disks not detected)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 scsidrv trkmenu<br /><br />label 9<br />kernel trinity/kernel.trk<br />menu label ^9 : TRK 3.4 with a secure shell server enabled<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 sshd<br /><br />label 10<br />kernel trinity/kernel.trk<br />menu label 10: TRK 3.4 - E^xecute local scripts on harddrive of PC<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 locscr<br /><br />label 11<br />menu label 11: TRK 3.4 as bootserve^r to boot other TRK clients<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 trkbootnet trkmenu<br /><br />label 12<br />kernel trinity/kernel.trk<br />menu label 12: TRK 3.4 - Fileshare all drives as ^guest, no security<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 smbguest trkmenu<br /><br />label 0<br />kernel trinity/kernel.trk<br />menu label 13: TRK 3.4 - ^Single user mode (no menu)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 runlevel 1<br /><br />label noacpi<br />kernel trinity/kernel.trk<br />menu label 14: TRK 3.4 - Acpi=off, noapic  PCI=^bios (Alternate boot 1)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose acpi=off noapic pci=bios trkmenu<br /><br />label pcinormal<br />kernel trinity/kernel.trk<br />menu label 15: TRK 3.4 - ^Acpi=off, noapic PCI=any (Alternate boot 2)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose acpi=off noapic trkmenu<br /><br />label pciconf1<br />kernel trinity/kernel.trk<br />menu label 16: TRK 3.4 - ^PCI=conf2 (Alternate boot 3)<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf2 trkmenu<br /><br />label debug<br />menu label 17: TRK 3.4 - ^Verbose startup for debugging (no menu)<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 debugging<br /><br />label 18<br />menu label 18: TRK 3.4 - SSH, boot- and guest ^fileserver, run from RAM<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 sshd trkinmem smbguest trkbootnet trkmenu<br /><br />label 19<br />menu label 19: TRK 3.4 - Run from RAM, run m^clone as client<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 trkinmem mclone<br /><br />label 20<br />menu label 20: TRK 3.4 with prox^yserver support enabled<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 proxy trkmenu<br /><br />label 21<br />menu label 21: TRK 3.4 - All devices set to read-only<br />kernel trinity/kernel.trk<br />append initrd=trinity/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 trknfs=192.168.1.13:/var/lib/tftpboot/trinity ip=::::::dhcp splash=verbose pci=conf1 allro<br /><br />label t<br />menu label 22: ^Memory tester: Memtest86+ v1.65<br />kernel memtest.x86<br /></pre>
