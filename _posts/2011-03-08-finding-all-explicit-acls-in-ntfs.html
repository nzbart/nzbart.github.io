---
layout: post
title: Finding all explicit ACLs in NTFS
---

Sometimes file permissions can become a little messed up, so this script will list all the explicitly set (i.e. not inherited) ACEs. I suggest that you use the Out-GridView, Format-Table, or ConvertTo-Csv Cmdlets to better visualise the result.<br /><br /><pre class="brush:ps">function Get-ExplicitAcl<br />{<br />    [CmdletBinding()]<br />    param([string]$Path, [switch]$Recurse)<br /> <br />    Process<br />    {<br />        $allFiles = Get-ChildItem $Path -Recurse:$Recurse | select -ExpandProperty FullName<br />        $allFiles += Get-Item $Path | select -ExpandProperty FullName<br />        $result = $allFiles | % {<br />            $current = $_<br />            try <br />            {<br />                $acl = get-acl -path $current<br />                if($acl)<br />                {<br />                    $dacl = $acl.GetAccessRules($true, $false, [System.Security.Principal.NTAccount])<br />                    foreach($ace in $dacl)<br />                    {<br />                        $detail = new-object psobject -Property @{ <br />                            Path = $current;<br />                            FileSystemRights = $ace.FileSystemRights;<br />                            AccessControlType = $ace.AccessControlType;<br />                            IdentityReference = $ace.IdentityReference;<br />                            InheritanceFlags = $ace.InheritanceFlags;<br />                            PropagationFlags = $ace.PropagationFlags;<br />                        }<br />                        $detail | select Path, AccessControlType, IdentityReference, FileSystemRights, InheritanceFlags, PropagationFlags<br />                    }<br />                }<br />            }<br />            catch [System.UnauthorizedAccessException]<br />            {<br />                Write-Error "Failed to read DACL from $current.FullName."    <br />            }<br />        }<br />        $result | sort path<br />    }<br />}</pre>
