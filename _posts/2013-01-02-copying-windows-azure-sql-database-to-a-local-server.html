---
layout: post
title: Copying Windows Azure SQL Database to a local server
---

<p>The following script will download a SQL Azure database and import it into a local running instance. It assumes the local database does not exist. The import step could also be used to create an off-site backup.</p> <p>This script uses the <a href="http://msdn.microsoft.com/en-us/library/hh550080(v=vs.103).aspx">SqlPackage</a> tool, which can be downloaded using the Web Platform Installer to install Microsoft SQL Server Data-Tier Application Framework (DACFx).</p> <p>You will need to replace the values surrounded in asterisks (*) for the script to work correctly.</p> <pre class="brush:ps"><br />param([string][parameter(mandatory)]$DatabaseAdministratorPassword)<br /><br />$sqlPackage = 'C:\Program Files (x86)\Microsoft SQL Server\110\DAC\bin\sqlpackage.exe'<br /><br />$bacPacFile = join-path $env:TEMP 'Import.bacpac'<br />try <br />{<br />    & $sqlPackage /a:Export /ssn:*****AZURE_DATABASE_SERVER***** /sdn:*****DATABASE_NAME***** /su:*****AZURE DATABASE ADMIN USER NAME***** /sp:$DatabaseAdministratorPassword /tf:$bacPacFile<br />    if(!$?) {<br />        throw "Failed to export database."<br />    }<br />    & $sqlPackage /a:Import /tdn:*****DATABASE_NAME***** /tsn:localhost\sqlexpress /sf:$bacPacFile<br />    if(!$?) {<br />        throw "Failed to import database."<br />    }<br />}<br />finally {<br />    del $bacPacFile<br />}<br /></pre>
